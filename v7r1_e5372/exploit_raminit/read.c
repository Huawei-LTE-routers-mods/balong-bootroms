#define uint16_t unsigned short
#define uint32_t unsigned int
#define UART 0x90007000
#define UART_WAIT 0x9000707C
//#define BOOTROM 0x900AB800
//#define BOOTROM 0x90140000
#define BOOTROM 0x0
#define BOOTROM_LENGTH 65536

#define UART_WAIT_FUNC do {     for (uint16_t uart_cnt = 0; uart_cnt < 65535; uart_cnt++) { \
        asm volatile ("dmb"); \
        if ((*(volatile uint32_t*)(UART_WAIT) & 2) != 0) \
            break; \
    }} while (0)
//#define UART_WAIT_FUNC do {     for (uint16_t uart_cnt = 0; uart_cnt < 65535; uart_cnt++) { \
//    }} while (0)

void func() {
    for (uint32_t br_cnt = 0; br_cnt < BOOTROM_LENGTH; br_cnt++) {
        UART_WAIT_FUNC;
        *(volatile uint32_t*)(UART) = ((volatile char*)(BOOTROM))[br_cnt];
    }
    while (1) {}
}
