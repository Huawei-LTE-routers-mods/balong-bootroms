#define uint16_t unsigned short
#define uint32_t unsigned int
#define UART 0xC4024000
#define UART_WAIT 0xC4024018
#define BOOTROM 0x80000
//#define BOOTROM 0x311FFE0A
#define BOOTROM_LENGTH 65535

#define UART_WAIT_FUNC do {     for (uint16_t uart_cnt = 0; uart_cnt < 65535; uart_cnt++) { \
        if ((*(volatile uint32_t*)(UART_WAIT) & 0x18) == 0x10) \
            break; \
    }} while (0)


void func() {
    //register uint32_t lr asm ("lr");

    *(volatile char*)(UART) = '!';

    for (uint16_t br_cnt = 0; br_cnt < BOOTROM_LENGTH; br_cnt++) {
        //*(volatile char*)(UART) = '!';
        UART_WAIT_FUNC;
        *(volatile char*)(UART) = ((volatile char*)(BOOTROM))[br_cnt];
    }
}
