#define uint16_t unsigned short
#define uint32_t unsigned int
#define UART 0xC4024000
#define UART_WAIT 0xC4024018
#define BOOTROM 0x80000
//#define BOOTROM 0x311FFE0A
#define BOOTROM_LENGTH 65535
#define USB_BEGIN (0x5cb98 + (4 * 12))

#define UART_WAIT_FUNC do {     for (uint16_t uart_cnt = 0; uart_cnt < 65535; uart_cnt++) { \
        if ((*(volatile uint32_t*)(UART_WAIT) & 0x18) == 0x10) \
            break; \
    }} while (0)

/*inline void pr(char c) {
    UART_WAIT_FUNC;
    *(volatile char*)(UART) = c;
}*/

//register char* usbstruct asm ("r4");
void func() {
    //void (*usb_send_byte)(char* usb, unsigned char byte) = 0x00082285;
    void (*efuse_read)(int group, uint32_t* ret, int count) = 0x00080C05;
    void (*boot_printf)(char* format, ...) = 0x083035;
    //uint32_t efuse = 0x5FFAC;
    uint32_t efuse;

    // Dump efuse
    for (uint16_t group = 0; group < 64; group++) {
        efuse_read(group, &efuse, 1);
        boot_printf("%d: %x\n", group, efuse);
    }

    // Dump stack and bootrom
    /*for (uint32_t cnt; cnt < 0x90000; cnt++) {
        pr(*((char*)(cnt)));
    }*/

    /*for (uint16_t i = 0; i<64; i++) {
        pr('0' + i);
        usb_send_byte(USB_BEGIN + i * 4, '0' + i);
    }*/

    /*for (uint16_t group = 0; group < 4; group++) {
        efuse_read(group + 40, efuse + group*4, 1);
    }
    int (*runa17)(uint32_t addr) = (uint32_t)0x80485;
    runa17(0x1c100000);*/
}
